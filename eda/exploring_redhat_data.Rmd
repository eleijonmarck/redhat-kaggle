---
title: "exploring-redhat-data"
output: pdf_document
date: "August 14, 2016"
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

```{r}
library(ggplot2)
library(data.table)
library(dplyr)
```

Functions for rendering HTML and PDF documents
```{r}
render_pdf <-  function() {
    rmarkdown::render('exploring_redhat_data.Rmd', 
                      output_file = 'markdown/exploring_redhat.pdf')
}

render_html <-  function() {
    rmarkdown::render('exploring_redhat_data.Rmd', 
                      output_file = 'markdown/exploring_redhat.html')
}
```

### TODO: Merge activities and people


### Read data
```{r, cache=TRUE}
activities_raw <- fread('../data/raw/act_train.csv')
people_raw <- fread('../data/raw/people.csv')

# Rename columns
cols <- paste0('char_', 1:10)
for (c in cols) {
    col_ind <- which(colnames(activities_raw) == c)
    colnames(activities_raw)[col_ind] <- paste0('activity_', c)
} 

cols <- paste0('char_', 1:38)
for (c in cols) {
    col_ind <- which(colnames(people_raw) == c)
    colnames(people_raw)[col_ind] <- paste0('people_', c)
} 

merged_raw <- fread('../data/processed/merged_data.csv')
```

### Data summary 
```{r, cache=TRUE}
head(activities_raw,2)
head(people_raw,2)
head(merged_raw,2)
```

Write merged data to disk
```{r, cache=TRUE}
# colnames(merged_raw)[which(colnames(merged_raw) == 'date.x')] <- 'people_date'
# colnames(merged_raw)[which(colnames(merged_raw) == 'date.y')] <- 'activity_date'
# write.csv(x=merged_raw, file='../data/processed/merged_data.csv')
# merged_raw <- merge(x=people_raw, y=activities_raw, by='people_id')
```

Inspect outomces for variable activity_char_1
```{r, cache=T}
counts <- table(activities_raw[, c('activity_char_1', 'outcome'), with=F])

activities_df <- as.data.frame(counts)
activities_df$activity_char_1 <- reorder(activities_df$activity_char_1, activities_df$Freq)
ind_split <- as.integer((length(levels(activities_df$activity_char_1))-1) / 2)
most_frequent_levels <- levels(activities_df$activity_char_1)[
    (ind_split+1): length(levels(activities_df$activity_char_1))]
second_frequent_levels <- levels(activities_df$activity_char_1)[1:ind_split]

ggplot(data=activities_df[activities_df$activity_char_1 %in% most_frequent_levels, ],  
       aes(x=activity_char_1, y=Freq,  color=outcome)) +
    geom_bar(stat='identity') +
    theme(axis.text.x=element_text(angle=90, size=11)) +
    scale_x_discrete(labels=abbreviate) +
    coord_flip()

ggplot(data=activities_df[activities_df$activity_char_1 %in% second_frequent_levels,],
       aes(x=activity_char_1, y=Freq, color=outcome)) +
    geom_bar(stat='identity') +
    theme(axis.text.x=element_text(angle=90, size=11)) +
    scale_x_discrete(labels=abbreviate) +
    coord_flip()


df_without_blanks <- activities_df[activities_df$activity_char_1 != '',]
df_without_blanks$activity_char_1 <- as.factor(df_without_blanks$activity_char_1)

ggplot(data=df_without_blanks[df_without_blanks$activity_char_1 %in% most_frequent_levels, ],  
       aes(x=activity_char_1, y=Freq, color=outcome)) +
    geom_bar(stat='identity') +  
    theme(axis.text.x=element_text(angle=90, size=11)) +
    scale_x_discrete(labels=abbreviate) +
    coord_flip()

ggplot(
    data=df_without_blanks[df_without_blanks$activity_char_1 %in% second_frequent_levels, ],  
       aes(x=activity_char_1, y=Freq, color=outcome)) +
    geom_bar(stat='identity') +  
    theme(axis.text.x=element_text(angle=90, size=11)) +
    scale_x_discrete(labels=abbreviate) +
    coord_flip()


counts <- table(activities_raw$activity_char_1)
counts[order(counts, decreasing=T)]
```

```{r, echo=F, results='hide'}
gc()
```
Most outcomes for variable activity_char_1 are blanks. Counting the number of blanks for each variable is
easily done by the colSums function
```{r, cache=T}
colSums(merged_raw == '')
```

```{r, echo=F, results='hide'}
gc()
```

Number of unqie values for each variable
```{r, cache=T}
apply(merged_raw, MARGIN=2, function(x) length(unique(x)))
```

```{r, echo=F, results='hide'}
gc()
```

By the data specification it is said that, type 1 activities are different from type 2-7 activities 
in the sense that there are more known characteristics associated with type 1 activities (nine in total) 
than type 2-7 activities (which have only one associated characteristic)

Get number of unique values while fixing activity 2
```{r, cache=T}
apply(merged_raw[merged_raw$activity_char_2==merged_raw$activity_char_2[1], ],
      MARGIN=2, function(x) length(unique(x)))
```

```{r, echo=F, results='hide'}
gc()
```

```{r, cache=T}
apply(merged_raw[merged_raw$activity_char_2==merged_raw$activity_char_2[250], ],
      MARGIN=2, function(x) length(unique(x)))
```

Number of unique values while fixing activity 1
```{r, cache=T}
apply(merged_raw[merged_raw$activity_char_2==merged_raw$activity_char_1[1], ],
      MARGIN=2, function(x) length(unique(x)))
```

```{r, echo=F, results='hide'}
gc()
```

```{r, cache=T}
apply(merged_raw[merged_raw$activity_char_2==merged_raw$activity_char_1[250], ],
      MARGIN=2, function(x) length(unique(x)))
```

```{r, echo=F, results='hide'}
gc()
```